// Generated by CoffeeScript 1.4.0
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  define(['paper', 'ball', 'frame'], function(paper, ball, frame) {
    var BaseModule;
    return BaseModule = (function() {

      function BaseModule(canvas, options) {
        this.play = __bind(this.play, this);
        this.canvas = canvas;
        this.paper = new paper.PaperScope();
        this.tool = new this.paper.Tool();
        this.paper.setup(this.canvas);
        this.view = new this.paper.View(canvas);
        this.options = options;
        this.view.draw = function() {
          return console.log("what goes in the draw?");
        };
        this.elements = {
          a: new ball(this.paper, this.options.a),
          b: new ball(this.paper, this.options.b),
          frame: new frame(this.paper, this.options.frame)
        };
        this.playing = false;
        this.paper.view.draw();
      }

      BaseModule.prototype.play = function() {
        var collision, counter, left, leftRunning, right, rightRunning, run,
          _this = this;
        left = this.elements.a;
        right = this.elements.b;
        frame = this.elements.frame;
        counter = 0;
        collision = false;
        rightRunning = true;
        leftRunning = true;
        run = function() {
          var fv, ml, mr, playing, vl, vlf, vr, vrf;
          playing = true;
          vr = right.getVelocity();
          vl = left.getVelocity();
          fv = frame.getVelocity();
          if (leftRunning) {
            left.element.position.x += vl + fv;
          }
          if (rightRunning) {
            right.element.position.x += vr + fv;
          }
          if (!collision && left.element.position.x + left.radius >= right.element.position.x - right.radius) {
            collision = true;
            ml = left.getMass();
            mr = right.getMass();
            vlf = ((vl * (ml - mr)) + (2 * mr * vr)) / (ml + mr);
            vrf = ((vr * (mr - ml)) + (2 * ml * vl)) / (ml + mr);
            left.setVelocity(vlf);
            right.setVelocity(vrf);
          }
          if (collision && left.element.position.x <= left.original.x) {
            leftRunning = false;
            left.fullReset();
          }
          if (collision && right.element.position.x <= left.original.x) {
            leftRunning = false;
            right.fullReset();
          }
          if (collision && right.element.position.x >= right.original.x) {
            rightRunning = false;
            right.fullReset();
          }
          if (collision && left.element.position.x >= right.original.x) {
            rightRunning = false;
            right.fullReset();
          }
          _this.paper.view.draw();
          if (rightRunning || leftRunning) {
            return setTimeout(run, 10);
          } else {
            return _this.playing = false;
          }
        };
        if (!this.playing) {
          return run();
        }
      };

      return BaseModule;

    })();
  });

}).call(this);
